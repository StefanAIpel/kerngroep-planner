<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#7C3AED">
    <title>Werkgeheugen</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --purple: #7C3AED;
            --purple-light: #A78BFA;
            --blue: #3B82F6;
            --green: #10B981;
            --yellow: #F59E0B;
            --orange: #F97316;
            --red: #EF4444;
            --pink: #EC4899;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-100);
            color: var(--gray-900);
            min-height: 100vh;
            min-height: 100dvh;
            overflow: hidden;
        }

        /* App Container */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            max-width: 430px;
            margin: 0 auto;
            background: var(--gray-100);
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .header {
            padding: calc(var(--safe-top) + 12px) 20px 12px;
            background: white;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        /* Main Content */
        .main {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            padding-bottom: calc(80px + var(--safe-bottom));
        }

        /* Tab Bar */
        .tab-bar {
            display: flex;
            background: white;
            border-top: 1px solid var(--gray-200);
            padding: 8px 0 calc(8px + var(--safe-bottom));
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 430px;
            margin: 0 auto;
            z-index: 100;
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s;
            position: relative;
        }

        .tab-item.active {
            color: var(--purple);
        }

        .tab-item svg {
            width: 24px;
            height: 24px;
        }

        .tab-badge {
            position: absolute;
            top: 4px;
            right: calc(50% - 20px);
            background: var(--red);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-subtitle {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Mascot Header */
        .mascot-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mascot {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--purple), var(--blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .mascot-eyes {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 14px;
        }

        .mascot-eye {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .mascot-mouth {
            position: absolute;
            bottom: 14px;
            width: 16px;
            height: 8px;
            border-bottom: 3px solid white;
            border-radius: 0 0 10px 10px;
        }

        .mascot-text h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .mascot-text p {
            font-size: 14px;
            color: var(--gray-500);
        }

        /* Quick Add */
        .quick-add-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .quick-add-input input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: var(--gray-100);
            border-radius: 12px;
            font-size: 16px;
            outline: none;
        }

        .quick-add-input input:focus {
            box-shadow: 0 0 0 2px var(--purple-light);
        }

        .quick-add-input button {
            padding: 12px;
            background: var(--purple);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-add-input button:active {
            transform: scale(0.95);
        }

        .voice-btn {
            width: 100%;
            padding: 12px;
            background: rgba(124, 58, 237, 0.1);
            color: var(--purple);
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .voice-btn.recording {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Microstep Card */
        .microstep-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .microstep-card:active {
            transform: scale(0.98);
        }

        .microstep-check {
            width: 28px;
            height: 28px;
            border: 2px solid var(--purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .microstep-check:hover {
            background: var(--purple);
            color: white;
        }

        .microstep-check.done {
            background: var(--green);
            border-color: var(--green);
            color: white;
        }

        .microstep-content {
            flex: 1;
            min-width: 0;
        }

        .microstep-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .microstep-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--gray-500);
        }

        .microstep-effort {
            padding: 2px 8px;
            background: var(--gray-200);
            border-radius: 4px;
            font-size: 11px;
        }

        /* Suggestion Card */
        .suggestion-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .suggestion-card.quick-win {
            background: rgba(245, 158, 11, 0.1);
        }

        .suggestion-icon {
            font-size: 24px;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-step {
            font-size: 14px;
            font-weight: 500;
        }

        .suggestion-task {
            font-size: 12px;
            color: var(--gray-500);
        }

        .suggestion-time {
            font-size: 11px;
            color: var(--gray-500);
            background: var(--gray-200);
            padding: 4px 8px;
            border-radius: 12px;
        }

        /* Stats Row */
        .stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .stat-icon {
            font-size: 20px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .empty-state h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--gray-700);
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Inbox View */
        .inbox-progress {
            margin-bottom: 16px;
        }

        .progress-bar {
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--purple);
            transition: width 0.3s;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray-500);
        }

        .triage-card {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            touch-action: pan-y;
            transition: transform 0.1s;
        }

        .triage-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .category-chip {
            padding: 12px 8px;
            background: var(--gray-100);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .category-chip.selected {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--purple);
        }

        .category-chip-icon {
            font-size: 20px;
        }

        .category-chip-label {
            font-size: 10px;
            font-weight: 500;
        }

        .priority-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .priority-chip {
            flex: 1;
            padding: 10px;
            background: var(--gray-100);
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .priority-chip.selected {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--purple);
        }

        .microstep-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            font-size: 14px;
            margin-bottom: 16px;
            outline: none;
        }

        .microstep-input:focus {
            border-color: var(--purple);
        }

        .triage-actions {
            display: flex;
            gap: 12px;
        }

        .triage-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .triage-btn:active {
            transform: scale(0.95);
        }

        .triage-btn.secondary {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .triage-btn.primary {
            background: var(--purple);
            color: white;
        }

        .triage-btn.primary:disabled {
            background: var(--gray-300);
        }

        /* Focus Mode */
        .focus-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95), rgba(59, 130, 246, 0.95));
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 20px;
            padding-top: calc(var(--safe-top) + 20px);
            padding-bottom: calc(var(--safe-bottom) + 20px);
            color: white;
        }

        .focus-overlay.active {
            display: flex;
        }

        .focus-close {
            align-self: flex-end;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
        }

        .focus-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .focus-category {
            font-size: 48px;
            margin-bottom: 8px;
        }

        .focus-category-name {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 32px;
        }

        .focus-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .focus-step {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            padding: 0 20px;
        }

        .focus-task-title {
            font-size: 14px;
            opacity: 0.6;
            margin-bottom: 32px;
        }

        .focus-timer {
            font-size: 32px;
            font-weight: 300;
            font-variant-numeric: tabular-nums;
            opacity: 0.7;
        }

        .focus-actions {
            padding: 20px;
        }

        .focus-done-btn {
            width: 100%;
            padding: 18px;
            background: white;
            color: var(--purple);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .focus-secondary-actions {
            display: flex;
            gap: 8px;
        }

        .focus-secondary-btn {
            flex: 1;
            padding: 14px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        /* Categories View */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .category-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .category-card:active {
            transform: scale(0.95);
        }

        .category-card-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .category-card-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .category-card-count {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Stats View */
        .level-card {
            text-align: center;
            padding: 24px;
        }

        .level-badge {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--purple), var(--blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .level-number {
            font-size: 32px;
            font-weight: 700;
            color: white;
        }

        .level-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .level-points {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 16px;
        }

        .level-progress {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .level-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--purple), var(--blue));
            transition: width 0.5s;
        }

        .level-next {
            font-size: 12px;
            color: var(--gray-500);
        }

        .streak-card {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .streak-icon {
            width: 60px;
            height: 60px;
            background: rgba(249, 115, 22, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .streak-info h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .streak-info p {
            font-size: 12px;
            color: var(--green);
        }

        .streak-dots {
            display: flex;
            gap: 4px;
            margin-left: auto;
        }

        .streak-dot {
            width: 8px;
            height: 8px;
            background: var(--orange);
            border-radius: 50%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-box {
            background: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .stat-box-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .stat-box-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-box-label {
            font-size: 11px;
            color: var(--gray-500);
        }

        .badges-section h3 {
            margin-bottom: 12px;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .badge-item {
            background: rgba(124, 58, 237, 0.1);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
        }

        .badge-item.locked {
            background: var(--gray-100);
            opacity: 0.6;
        }

        .badge-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .badge-name {
            font-size: 10px;
            font-weight: 500;
        }

        /* Settings View */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding-left: 4px;
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-label {
            font-size: 15px;
        }

        .settings-item-value {
            font-size: 14px;
            color: var(--gray-500);
        }

        /* Toggle Switch */
        .toggle {
            width: 50px;
            height: 30px;
            background: var(--gray-300);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--purple);
        }

        .toggle-knob {
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle.active .toggle-knob {
            transform: translateX(20px);
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 2000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            font-size: 24px;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Points Popup */
        .points-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--purple);
            color: white;
            padding: 20px 40px;
            border-radius: 50%;
            font-size: 32px;
            font-weight: 700;
            z-index: 2000;
            animation: points-pop 1.5s ease-out forwards;
        }

        @keyframes points-pop {
            0% { transform: translate(-50%, -50%) scale(0); }
            20% { transform: translate(-50%, -50%) scale(1.2); }
            40% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1500;
            opacity: 0;
            transition: all 0.3s;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Category Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 500;
            display: none;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-width: 430px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: calc(20px + var(--safe-bottom));
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: var(--gray-100);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
        }

        .task-list-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .task-check {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-check:hover {
            border-color: var(--green);
            background: var(--green);
            color: white;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 14px;
            font-weight: 500;
        }

        .task-meta {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* Check-in View */
        .checkin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gray-100);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .checkin-overlay.active {
            display: flex;
        }

        .checkin-header {
            padding: calc(var(--safe-top) + 16px) 20px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkin-title {
            font-size: 18px;
            font-weight: 600;
        }

        .checkin-close {
            background: none;
            border: none;
            font-size: 16px;
            color: var(--gray-500);
            cursor: pointer;
        }

        .checkin-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 8px;
        }

        .checkin-dot {
            width: 8px;
            height: 8px;
            background: var(--gray-300);
            border-radius: 50%;
        }

        .checkin-dot.active {
            background: var(--purple);
        }

        .checkin-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .checkin-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .checkin-heading {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .checkin-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            color: var(--green);
            margin-bottom: 24px;
        }

        .checkin-completed-list {
            width: 100%;
            max-width: 300px;
            text-align: left;
        }

        .checkin-completed-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .checkin-suggestion {
            width: 100%;
            max-width: 300px;
            padding: 20px;
            background: rgba(124, 58, 237, 0.1);
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .checkin-suggestion-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .checkin-suggestion-task {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .checkin-suggestion-step {
            font-size: 14px;
            color: var(--gray-600);
        }

        .checkin-braindump {
            width: 100%;
            max-width: 300px;
        }

        .checkin-braindump textarea {
            width: 100%;
            height: 120px;
            padding: 16px;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            font-size: 14px;
            resize: none;
            margin-bottom: 12px;
        }

        .checkin-braindump-tip {
            font-size: 12px;
            color: var(--gray-500);
        }

        .checkin-actions {
            padding: 20px;
            padding-bottom: calc(20px + var(--safe-bottom));
            display: flex;
            gap: 12px;
        }

        .checkin-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .checkin-btn.secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .checkin-btn.primary {
            background: var(--purple);
            color: white;
        }

        /* Completion celebration */
        .checkin-complete {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .checkin-complete.active {
            display: flex;
        }

        .checkin-complete-content {
            text-align: center;
            color: white;
        }

        .checkin-complete-icon {
            font-size: 80px;
            margin-bottom: 16px;
        }

        .checkin-complete-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .checkin-complete-message {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 24px;
        }

        .checkin-complete-btn {
            background: white;
            color: var(--purple);
            border: none;
            padding: 16px 32px;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <h1 id="header-title">Nu</h1>
        </div>

        <!-- Main Content -->
        <div class="main">
            <!-- Home View -->
            <div class="view active" id="view-home">
                <!-- Mascot -->
                <div class="card">
                    <div class="mascot-header">
                        <div class="mascot">
                            <div class="mascot-eyes">
                                <div class="mascot-eye"></div>
                                <div class="mascot-eye"></div>
                            </div>
                            <div class="mascot-mouth"></div>
                        </div>
                        <div class="mascot-text">
                            <h3>Hoi! üëã</h3>
                            <p id="mascot-message">Je kan dit!</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Add -->
                <div class="card">
                    <div class="quick-add-input">
                        <input type="text" id="quick-add-input" placeholder="Snel iets toevoegen...">
                        <button id="quick-add-btn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14"/></svg>
                        </button>
                    </div>
                    <button class="voice-btn" id="voice-btn">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z"/><path d="M19 11a7 7 0 0 1-14 0H3a9 9 0 0 0 8 8.94V22h2v-2.06A9 9 0 0 0 21 11h-2z"/></svg>
                        <span>Spreek je taak in</span>
                    </button>
                </div>

                <!-- Today's Focus -->
                <div class="card">
                    <div class="card-title">
                        <span>Vandaag</span>
                        <span class="card-subtitle" id="today-count">0 microstappen</span>
                    </div>
                    <div id="today-tasks">
                        <div class="empty-state">
                            <div class="empty-state-icon">‚úÖ</div>
                            <h3>Alles gedaan!</h3>
                            <p>Of voeg iets toe hierboven</p>
                        </div>
                    </div>
                </div>

                <!-- Suggestions -->
                <div class="card">
                    <div class="card-title">Wat kan ik oppakken?</div>
                    <div id="suggestions-list"></div>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <div class="stats-row">
                        <div class="stat-item">
                            <span class="stat-icon">‚≠ê</span>
                            <span class="stat-value" id="stat-points">0</span>
                            <span class="stat-label">Punten</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üî•</span>
                            <span class="stat-value" id="stat-streak">0</span>
                            <span class="stat-label">Streak</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üèÜ</span>
                            <span class="stat-value" id="stat-level">Lvl 1</span>
                            <span class="stat-label">Level</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inbox View -->
            <div class="view" id="view-inbox">
                <div id="inbox-content">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- Categories View -->
            <div class="view" id="view-categories">
                <div class="categories-grid" id="categories-grid">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- Stats View -->
            <div class="view" id="view-stats">
                <!-- Level Card -->
                <div class="card level-card">
                    <div class="level-badge">
                        <span class="level-number" id="level-number">1</span>
                    </div>
                    <div class="level-title" id="level-title">Level 1</div>
                    <div class="level-points" id="level-points-text">0 punten</div>
                    <div class="level-progress">
                        <div class="level-progress-fill" id="level-progress" style="width: 0%"></div>
                    </div>
                    <div class="level-next" id="level-next">Nog 100 punten tot level 2</div>
                </div>

                <!-- Streak Card -->
                <div class="card streak-card">
                    <div class="streak-icon">üî•</div>
                    <div class="streak-info">
                        <h3 id="streak-days">0 dagen streak</h3>
                        <p id="streak-status">Start vandaag!</p>
                    </div>
                    <div class="streak-dots" id="streak-dots"></div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-box-icon">‚úÖ</div>
                        <div class="stat-box-value" id="stats-tasks-done">0</div>
                        <div class="stat-box-label">Taken klaar</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">‚ö°</div>
                        <div class="stat-box-value" id="stats-microsteps">0</div>
                        <div class="stat-box-label">Microstappen</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">üì•</div>
                        <div class="stat-box-value" id="stats-triaged">0</div>
                        <div class="stat-box-label">Inbox getriaged</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">üéØ</div>
                        <div class="stat-box-value" id="stats-focus">0</div>
                        <div class="stat-box-label">Focus sessies</div>
                    </div>
                </div>

                <!-- Badges -->
                <div class="card badges-section">
                    <h3>Badges</h3>
                    <div class="badges-grid" id="badges-grid">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div class="view" id="view-settings">
                <div class="settings-section">
                    <div class="settings-title">Notificaties</div>
                    <div class="settings-card">
                        <div class="settings-item">
                            <span class="settings-item-label">Notificaties aan</span>
                            <div class="toggle active" id="toggle-notifications">
                                <div class="toggle-knob"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="settings-item-label">Ochtend</span>
                            <span class="settings-item-value">08:30</span>
                        </div>
                        <div class="settings-item">
                            <span class="settings-item-label">Middag</span>
                            <span class="settings-item-value">13:00</span>
                        </div>
                        <div class="settings-item">
                            <span class="settings-item-label">Avond</span>
                            <span class="settings-item-value">21:30</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">Beleving</div>
                    <div class="settings-card">
                        <div class="settings-item">
                            <span class="settings-item-label">Haptics</span>
                            <div class="toggle active" id="toggle-haptics">
                                <div class="toggle-knob"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="settings-item-label">Confetti</span>
                            <div class="toggle active" id="toggle-confetti">
                                <div class="toggle-knob"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="settings-item-label">Mascotte</span>
                            <div class="toggle active" id="toggle-mascot">
                                <div class="toggle-knob"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">Data</div>
                    <div class="settings-card">
                        <div class="settings-item" id="export-json" style="cursor: pointer;">
                            <span class="settings-item-label">üìÑ Exporteer als JSON</span>
                            <span class="settings-item-value">‚Üí</span>
                        </div>
                        <div class="settings-item" id="reset-data" style="cursor: pointer; color: var(--red);">
                            <span class="settings-item-label">üóëÔ∏è Reset alle data</span>
                            <span class="settings-item-value">‚Üí</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">Over</div>
                    <div class="settings-card">
                        <div class="settings-item">
                            <span class="settings-item-label">Versie</span>
                            <span class="settings-item-value">1.0.0 (Web MVP)</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">Demo</div>
                    <div class="settings-card">
                        <div class="settings-item" id="add-demo-tasks" style="cursor: pointer;">
                            <span class="settings-item-label">‚ûï Voeg demo taken toe</span>
                            <span class="settings-item-value">‚Üí</span>
                        </div>
                        <div class="settings-item" id="open-checkin" style="cursor: pointer;">
                            <span class="settings-item-label">üåô Open avond check-in</span>
                            <span class="settings-item-value">‚Üí</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <button class="tab-item active" data-view="home">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                <span>Nu</span>
            </button>
            <button class="tab-item" data-view="inbox">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 16H5v-3h3.56c.69 1.19 1.97 2 3.44 2s2.75-.81 3.44-2H19v3zm0-5h-4.99a2 2 0 0 1-2.01 2 2 2 0 0 1-2.01-2H5V5h14v9z"/></svg>
                <span>Inbox</span>
                <span class="tab-badge" id="inbox-badge" style="display: none;">0</span>
            </button>
            <button class="tab-item" data-view="categories">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M4 5v5h5V5H4zm0 14h5v-5H4v5zm9 0h5v-5h-5v5zm0-14v5h5V5h-5z"/></svg>
                <span>Categorie√´n</span>
            </button>
            <button class="tab-item" data-view="stats">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M5 9.2h3V19H5V9.2zM10.6 5h2.8v14h-2.8V5zm5.6 8H19v6h-2.8v-6z"/></svg>
                <span>Stats</span>
            </button>
            <button class="tab-item" data-view="settings">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 0 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.6 3.6 0 1 1 12 8.4a3.6 3.6 0 0 1 0 7.2z"/></svg>
                <span>Instellingen</span>
            </button>
        </div>
    </div>

    <!-- Focus Mode Overlay -->
    <div class="focus-overlay" id="focus-overlay">
        <button class="focus-close" id="focus-close">‚úï</button>
        <div class="focus-content">
            <div class="focus-category" id="focus-category-icon">üè¢</div>
            <div class="focus-category-name" id="focus-category-name">Werk</div>
            <div class="focus-label">Je enige focus:</div>
            <div class="focus-step" id="focus-step">Open de mail</div>
            <div class="focus-task-title" id="focus-task-title">Beantwoord mail accountant</div>
            <div class="focus-timer" id="focus-timer">00:00</div>
        </div>
        <div class="focus-actions">
            <button class="focus-done-btn" id="focus-done-btn">‚úì Klaar!</button>
            <div class="focus-secondary-actions">
                <button class="focus-secondary-btn" id="focus-snooze-btn">
                    <span>üò¥</span>
                    <span>Snooze</span>
                </button>
                <button class="focus-secondary-btn" id="focus-split-btn">
                    <span>‚úÇÔ∏è</span>
                    <span>Splits</span>
                </button>
                <button class="focus-secondary-btn" id="focus-complete-task-btn">
                    <span>üèÅ</span>
                    <span>Hele taak</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Category Detail Modal -->
    <div class="modal-overlay" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="modal-category-icon">üè¢</span>
                    <span id="modal-category-name">Werk</span>
                </div>
                <button class="modal-close" id="modal-close">‚úï</button>
            </div>
            <div id="modal-tasks-list">
                <!-- Filled by JS -->
            </div>
        </div>
    </div>

    <!-- Check-in Overlay -->
    <div class="checkin-overlay" id="checkin-overlay">
        <div class="checkin-header">
            <span class="checkin-title">Avond Check-in</span>
            <button class="checkin-close" id="checkin-close">Sluiten</button>
        </div>
        <div class="checkin-progress">
            <div class="checkin-dot active" data-step="0"></div>
            <div class="checkin-dot" data-step="1"></div>
            <div class="checkin-dot" data-step="2"></div>
        </div>
        <div class="checkin-content" id="checkin-content">
            <!-- Filled by JS -->
        </div>
        <div class="checkin-actions">
            <button class="checkin-btn secondary" id="checkin-back" style="display: none;">Terug</button>
            <button class="checkin-btn primary" id="checkin-next">Volgende</button>
        </div>
    </div>

    <!-- Check-in Complete -->
    <div class="checkin-complete" id="checkin-complete">
        <div class="checkin-complete-content">
            <div class="checkin-complete-icon">üåü</div>
            <div class="checkin-complete-title">Check-in voltooid!</div>
            <div class="checkin-complete-message">Slaap lekker, morgen weer!</div>
            <button class="checkin-complete-btn" id="checkin-complete-close">Welterusten!</button>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confetti-container"></div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== DATA ====================
        const CATEGORIES = [
            { id: 'werk', name: 'Werk', icon: 'üè¢', defaultMicro: 'Check 1 mail' },
            { id: 'apps', name: 'Apps', icon: 'üì±', defaultMicro: 'Open project, lees 1 TODO' },
            { id: 'voetbal', name: 'Voetbal', icon: '‚öΩ', defaultMicro: 'Check teamapp' },
            { id: 'straat', name: 'Straatambassadeurs', icon: 'üö∂', defaultMicro: 'Plan 1 wandeling' },
            { id: 'gezin', name: 'Gezin', icon: 'üë®‚Äçüë©‚Äçüëß', defaultMicro: 'Stuur 1 berichtje' },
            { id: 'financien', name: 'Financi√´n', icon: 'üí∞', defaultMicro: 'Check 1 rekening' }
        ];

        const EFFORTS = [
            { id: 'micro', label: '‚ö° Micro', minutes: 2 },
            { id: 'klein', label: 'üîπ Klein', minutes: 15 },
            { id: 'middel', label: 'üî∑ Middel', minutes: 60 },
            { id: 'groot', label: 'üî∂ Groot', minutes: 120 }
        ];

        const PRIORITIES = [
            { id: 'p1', label: 'P1 üî¥' },
            { id: 'p2', label: 'P2 üü°' },
            { id: 'p3', label: 'P3 üü¢' }
        ];

        const BADGES = [
            { id: 'opDreef', name: 'Op Dreef', icon: 'üî•', desc: '3 dagen streak', check: s => s.streak >= 3 },
            { id: 'microMaster', name: 'Micro Master', icon: '‚ö°', desc: '25 microstappen', check: s => s.microsteps >= 25 },
            { id: 'inboxZero', name: 'Inbox Zero', icon: 'üì•', desc: 'Inbox leeg', check: (s, tasks) => tasks.filter(t => t.status === 'inbox').length === 0 && s.triaged > 0 },
            { id: 'focusHeld', name: 'Focus Held', icon: 'üéØ', desc: '10 focus sessies', check: s => s.focusSessions >= 10 },
            { id: 'weekWarrior', name: 'Week Warrior', icon: '‚öîÔ∏è', desc: '7 dagen streak', check: s => s.streak >= 7 },
            { id: 'centuryClub', name: 'Century Club', icon: 'üíØ', desc: '100 taken', check: s => s.tasksDone >= 100 }
        ];

        const MASCOT_MESSAGES = [
            'Je kan dit! üí™',
            'E√©n stapje maar!',
            'Kleine stappen, grote resultaten!',
            'Begin gewoon, de rest volgt! üåü',
            'Elke stap telt!'
        ];

        // ==================== STATE ====================
        let state = {
            tasks: [],
            stats: {
                points: 0,
                streak: 0,
                level: 1,
                tasksDone: 0,
                microsteps: 0,
                triaged: 0,
                focusSessions: 0,
                lastCheckIn: null,
                badges: []
            },
            currentView: 'home',
            focusTask: null,
            focusTimer: null,
            focusSeconds: 0,
            triageIndex: 0,
            checkinStep: 0,
            settings: {
                notifications: true,
                haptics: true,
                confetti: true,
                mascot: true
            }
        };

        // ==================== STORAGE ====================
        function saveState() {
            localStorage.setItem('werkgeheugen', JSON.stringify({
                tasks: state.tasks,
                stats: state.stats,
                settings: state.settings
            }));
        }

        function loadState() {
            const saved = localStorage.getItem('werkgeheugen');
            if (saved) {
                const data = JSON.parse(saved);
                state.tasks = data.tasks || [];
                state.stats = { ...state.stats, ...data.stats };
                state.settings = { ...state.settings, ...data.settings };
            }
        }

        // ==================== TASK HELPERS ====================
        function createTask(title, category = null, microStep = '') {
            return {
                id: Date.now().toString(),
                title,
                category,
                priority: 'p3',
                effort: 'klein',
                status: category ? 'active' : 'inbox',
                microStep,
                createdAt: new Date().toISOString(),
                completedAt: null
            };
        }

        function getCategory(id) {
            return CATEGORIES.find(c => c.id === id);
        }

        function getEffort(id) {
            return EFFORTS.find(e => e.id === id);
        }

        function getInboxTasks() {
            return state.tasks.filter(t => t.status === 'inbox');
        }

        function getActiveTasks() {
            return state.tasks.filter(t => t.status === 'active');
        }

        function getTodayTasks() {
            const active = getActiveTasks();
            // Sort by priority, then effort
            return active.sort((a, b) => {
                if (a.priority !== b.priority) return a.priority.localeCompare(b.priority);
                const effortOrder = { micro: 0, klein: 1, middel: 2, groot: 3 };
                return effortOrder[a.effort] - effortOrder[b.effort];
            }).slice(0, 3);
        }

        function getTodayCompleted() {
            const today = new Date().toDateString();
            return state.tasks.filter(t => {
                if (!t.completedAt) return false;
                return new Date(t.completedAt).toDateString() === today;
            });
        }

        function getCategoryTasks(categoryId) {
            return state.tasks.filter(t => t.category === categoryId && t.status === 'active');
        }

        function getMicroStep(task) {
            if (task.microStep) return task.microStep;
            const cat = getCategory(task.category);
            return cat ? cat.defaultMicro : 'Start met deze taak';
        }

        // ==================== POINTS & BADGES ====================
        function addPoints(amount) {
            state.stats.points += amount;
            state.stats.level = Math.floor(state.stats.points / 100) + 1;
            showPointsPopup(amount);
            checkBadges();
            saveState();
        }

        function checkBadges() {
            BADGES.forEach(badge => {
                if (!state.stats.badges.includes(badge.id)) {
                    if (badge.check(state.stats, state.tasks)) {
                        state.stats.badges.push(badge.id);
                        showToast(`üéâ Nieuwe badge: ${badge.icon} ${badge.name}!`);
                        if (state.settings.confetti) showConfetti();
                    }
                }
            });
        }

        // ==================== UI HELPERS ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function showPointsPopup(points) {
            const popup = document.createElement('div');
            popup.className = 'points-popup';
            popup.textContent = `+${points}`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }

        function showConfetti() {
            const container = document.getElementById('confetti-container');
            const emojis = ['üéâ', '‚ú®', '‚≠ê', 'üíú', 'üíô', 'üíõ', 'üéä'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                container.appendChild(confetti);
            }
            setTimeout(() => container.innerHTML = '', 3000);
        }

        function vibrate() {
            if (state.settings.haptics && navigator.vibrate) {
                navigator.vibrate(10);
            }
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderHome() {
            // Mascot message
            document.getElementById('mascot-message').textContent =
                MASCOT_MESSAGES[Math.floor(Math.random() * MASCOT_MESSAGES.length)];

            // Today's tasks
            const todayTasks = getTodayTasks();
            const todayContainer = document.getElementById('today-tasks');
            document.getElementById('today-count').textContent = `${todayTasks.length} microstappen`;

            if (todayTasks.length === 0) {
                todayContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <h3>Alles gedaan!</h3>
                        <p>Of voeg iets toe hierboven</p>
                    </div>
                `;
            } else {
                todayContainer.innerHTML = todayTasks.map(task => {
                    const cat = getCategory(task.category);
                    const effort = getEffort(task.effort);
                    return `
                        <div class="microstep-card" data-task-id="${task.id}">
                            <div class="microstep-check" data-action="complete">‚úì</div>
                            <div class="microstep-content">
                                <div class="microstep-title">${getMicroStep(task)}</div>
                                <div class="microstep-meta">
                                    <span>${cat ? cat.icon : 'üì¶'}</span>
                                    <span class="microstep-effort">${effort ? effort.label : 'üîπ Klein'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Suggestions
            const suggestions = [];
            ['werk', 'gezin', 'financien'].forEach(catId => {
                const cat = getCategory(catId);
                const tasks = getCategoryTasks(catId);
                if (tasks.length > 0) {
                    const task = tasks[0];
                    suggestions.push({ task, cat, isQuickWin: false });
                } else {
                    suggestions.push({ task: null, cat, isQuickWin: false });
                }
            });

            // Quick win
            const allActive = getActiveTasks().filter(t => t.effort === 'micro' || t.effort === 'klein');
            if (allActive.length > 0) {
                const quickWin = allActive[0];
                const cat = getCategory(quickWin.category);
                suggestions.push({ task: quickWin, cat, isQuickWin: true });
            }

            document.getElementById('suggestions-list').innerHTML = suggestions.map(s => {
                const microStep = s.task ? getMicroStep(s.task) : s.cat.defaultMicro;
                const effort = s.task ? getEffort(s.task.effort) : EFFORTS[0];
                return `
                    <div class="suggestion-card ${s.isQuickWin ? 'quick-win' : ''}" data-task-id="${s.task ? s.task.id : ''}" data-category="${s.cat.id}">
                        <span class="suggestion-icon">${s.cat.icon}</span>
                        <div class="suggestion-content">
                            <div class="suggestion-step">${microStep}</div>
                            ${s.task ? `<div class="suggestion-task">${s.task.title}</div>` : ''}
                        </div>
                        <span class="suggestion-time">~${effort.minutes} min</span>
                    </div>
                `;
            }).join('');

            // Stats
            document.getElementById('stat-points').textContent = state.stats.points;
            document.getElementById('stat-streak').textContent = state.stats.streak;
            document.getElementById('stat-level').textContent = `Lvl ${state.stats.level}`;
        }

        function renderInbox() {
            const inboxTasks = getInboxTasks();
            const container = document.getElementById('inbox-content');

            // Update badge
            const badge = document.getElementById('inbox-badge');
            if (inboxTasks.length > 0) {
                badge.style.display = 'block';
                badge.textContent = inboxTasks.length;
            } else {
                badge.style.display = 'none';
            }

            if (inboxTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding-top: 100px;">
                        <div class="empty-state-icon">üì•</div>
                        <h3>Inbox is leeg!</h3>
                        <p>Gebruik Quick Add of Voice om<br>nieuwe taken toe te voegen</p>
                        <div style="font-size: 32px; margin-top: 16px;">‚ú®</div>
                    </div>
                `;
                return;
            }

            const task = inboxTasks[state.triageIndex % inboxTasks.length];

            container.innerHTML = `
                <div class="inbox-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${((state.triageIndex + 1) / inboxTasks.length) * 100}%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Taak ${state.triageIndex + 1} van ${inboxTasks.length}</span>
                        <span>${state.stats.triaged} getriaged ‚úì</span>
                    </div>
                </div>

                <div class="triage-card">
                    <div class="triage-title">${task.title}</div>

                    <div style="text-align: left; margin-bottom: 8px; font-size: 13px; font-weight: 500;">Categorie</div>
                    <div class="category-grid">
                        ${CATEGORIES.map(c => `
                            <div class="category-chip" data-category="${c.id}">
                                <span class="category-chip-icon">${c.icon}</span>
                                <span class="category-chip-label">${c.name}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div style="text-align: left; margin-bottom: 8px; font-size: 13px; font-weight: 500;">Prioriteit</div>
                    <div class="priority-row">
                        ${PRIORITIES.map(p => `
                            <div class="priority-chip ${p.id === 'p3' ? 'selected' : ''}" data-priority="${p.id}">${p.label}</div>
                        `).join('')}
                    </div>

                    <input type="text" class="microstep-input" id="triage-microstep" placeholder="Eerste microstap (optioneel)">

                    <div class="triage-actions">
                        <button class="triage-btn secondary" id="triage-skip">Later</button>
                        <button class="triage-btn primary" id="triage-save" disabled>Opslaan</button>
                    </div>
                </div>
            `;

            // Event listeners for triage
            let selectedCategory = null;
            let selectedPriority = 'p3';

            container.querySelectorAll('.category-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    container.querySelectorAll('.category-chip').forEach(c => c.classList.remove('selected'));
                    chip.classList.add('selected');
                    selectedCategory = chip.dataset.category;
                    document.getElementById('triage-save').disabled = false;
                    vibrate();
                });
            });

            container.querySelectorAll('.priority-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    container.querySelectorAll('.priority-chip').forEach(c => c.classList.remove('selected'));
                    chip.classList.add('selected');
                    selectedPriority = chip.dataset.priority;
                    vibrate();
                });
            });

            document.getElementById('triage-skip').addEventListener('click', () => {
                state.triageIndex++;
                renderInbox();
            });

            document.getElementById('triage-save').addEventListener('click', () => {
                if (!selectedCategory) return;

                task.category = selectedCategory;
                task.priority = selectedPriority;
                task.microStep = document.getElementById('triage-microstep').value;
                task.status = 'active';

                state.stats.triaged++;
                if (state.stats.triaged % 5 === 0) {
                    addPoints(15);
                }

                saveState();
                state.triageIndex++;
                renderInbox();
                renderHome();
                showToast('Taak opgeslagen! ‚úì');
                vibrate();
            });
        }

        function renderCategories() {
            const grid = document.getElementById('categories-grid');
            grid.innerHTML = CATEGORIES.map(cat => {
                const count = getCategoryTasks(cat.id).length;
                return `
                    <div class="category-card" data-category="${cat.id}">
                        <div class="category-card-icon">${cat.icon}</div>
                        <div class="category-card-name">${cat.name}</div>
                        <div class="category-card-count">${count} taken</div>
                    </div>
                `;
            }).join('');
        }

        function renderCategoryModal(categoryId) {
            const cat = getCategory(categoryId);
            const tasks = getCategoryTasks(categoryId);

            document.getElementById('modal-category-icon').textContent = cat.icon;
            document.getElementById('modal-category-name').textContent = cat.name;

            const list = document.getElementById('modal-tasks-list');
            if (tasks.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <p>Geen actieve taken in ${cat.name}</p>
                    </div>
                `;
            } else {
                list.innerHTML = tasks.map(task => {
                    const effort = getEffort(task.effort);
                    return `
                        <div class="task-list-item" data-task-id="${task.id}">
                            <div class="task-check" data-action="complete">‚úì</div>
                            <div class="task-info">
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">${getMicroStep(task)} ‚Ä¢ ${effort.label}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            document.getElementById('category-modal').classList.add('active');
        }

        function renderStats() {
            const s = state.stats;

            // Level
            document.getElementById('level-number').textContent = s.level;
            document.getElementById('level-title').textContent = `Level ${s.level}`;
            document.getElementById('level-points-text').textContent = `${s.points} punten`;
            const progress = (s.points % 100);
            document.getElementById('level-progress').style.width = `${progress}%`;
            document.getElementById('level-next').textContent = `Nog ${100 - progress} punten tot level ${s.level + 1}`;

            // Streak
            document.getElementById('streak-days').textContent = `${s.streak} dagen streak`;
            document.getElementById('streak-status').textContent = s.streak > 0 ? '‚úì Actief!' : 'Start vandaag!';
            document.getElementById('streak-dots').innerHTML = Array(Math.min(s.streak, 7)).fill('<div class="streak-dot"></div>').join('');

            // Stats
            document.getElementById('stats-tasks-done').textContent = s.tasksDone;
            document.getElementById('stats-microsteps').textContent = s.microsteps;
            document.getElementById('stats-triaged').textContent = s.triaged;
            document.getElementById('stats-focus').textContent = s.focusSessions;

            // Badges
            const badgesGrid = document.getElementById('badges-grid');
            badgesGrid.innerHTML = BADGES.map(badge => {
                const earned = s.badges.includes(badge.id);
                return `
                    <div class="badge-item ${earned ? '' : 'locked'}">
                        <div class="badge-icon">${earned ? badge.icon : 'üîí'}</div>
                        <div class="badge-name">${badge.name}</div>
                    </div>
                `;
            }).join('');
        }

        function renderSettings() {
            // Toggles
            const toggles = ['notifications', 'haptics', 'confetti', 'mascot'];
            toggles.forEach(key => {
                const toggle = document.getElementById(`toggle-${key}`);
                if (toggle) {
                    toggle.classList.toggle('active', state.settings[key]);
                }
            });
        }

        // ==================== FOCUS MODE ====================
        function openFocusMode(task) {
            state.focusTask = task;
            state.focusSeconds = 0;

            const cat = getCategory(task.category);
            document.getElementById('focus-category-icon').textContent = cat ? cat.icon : 'üì¶';
            document.getElementById('focus-category-name').textContent = cat ? cat.name : 'Overig';
            document.getElementById('focus-step').textContent = getMicroStep(task);
            document.getElementById('focus-task-title').textContent = task.title;
            document.getElementById('focus-timer').textContent = '00:00';

            document.getElementById('focus-overlay').classList.add('active');

            state.focusTimer = setInterval(() => {
                state.focusSeconds++;
                const mins = Math.floor(state.focusSeconds / 60).toString().padStart(2, '0');
                const secs = (state.focusSeconds % 60).toString().padStart(2, '0');
                document.getElementById('focus-timer').textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function closeFocusMode() {
            clearInterval(state.focusTimer);
            state.focusTask = null;
            document.getElementById('focus-overlay').classList.remove('active');
        }

        function completeFocusTask(completeWholeTask = false) {
            if (!state.focusTask) return;

            if (completeWholeTask) {
                state.focusTask.status = 'done';
                state.focusTask.completedAt = new Date().toISOString();
                state.stats.tasksDone++;
                addPoints(25);
            } else {
                state.stats.microsteps++;
                addPoints(10);
            }

            state.stats.focusSessions++;
            saveState();

            if (state.settings.confetti) showConfetti();
            vibrate();

            closeFocusMode();
            renderHome();
            renderCategories();
            renderStats();

            showToast(completeWholeTask ? 'Taak afgerond! üéâ' : 'Microstap gedaan! ‚ö°');
        }

        // ==================== CHECK-IN ====================
        function openCheckIn() {
            state.checkinStep = 0;
            renderCheckinStep();
            document.getElementById('checkin-overlay').classList.add('active');
        }

        function closeCheckIn() {
            document.getElementById('checkin-overlay').classList.remove('active');
        }

        function renderCheckinStep() {
            const content = document.getElementById('checkin-content');
            const backBtn = document.getElementById('checkin-back');
            const nextBtn = document.getElementById('checkin-next');

            // Update dots
            document.querySelectorAll('.checkin-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i <= state.checkinStep);
            });

            backBtn.style.display = state.checkinStep > 0 ? 'block' : 'none';
            nextBtn.textContent = state.checkinStep === 2 ? 'Afronden' : 'Volgende';

            const completed = getTodayCompleted();

            switch (state.checkinStep) {
                case 0:
                    content.innerHTML = `
                        <div class="checkin-icon">üåô</div>
                        <div class="checkin-heading">Goed gedaan vandaag!</div>
                        <div class="checkin-stats">
                            <span>‚úÖ</span>
                            <span>${completed.length} taken afgerond</span>
                        </div>
                        ${completed.length > 0 ? `
                            <div class="checkin-completed-list">
                                ${completed.slice(0, 5).map(t => `
                                    <div class="checkin-completed-item">
                                        <span>‚úì</span>
                                        <span>${t.title}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="color: var(--gray-500);">Morgen is een nieuwe dag! üí™</p>'}
                    `;
                    break;

                case 1:
                    const active = getActiveTasks();
                    const suggestion = active.length > 0 ? active[0] : null;
                    const cat = suggestion ? getCategory(suggestion.category) : null;

                    content.innerHTML = `
                        <div class="checkin-icon">‚òÄÔ∏è</div>
                        <div class="checkin-heading">Top 1 voor morgen</div>
                        ${suggestion ? `
                            <div class="checkin-suggestion">
                                <div class="checkin-suggestion-icon">${cat ? cat.icon : 'üì¶'}</div>
                                <div class="checkin-suggestion-task">${suggestion.title}</div>
                                <div class="checkin-suggestion-step">${getMicroStep(suggestion)}</div>
                            </div>
                        ` : '<p style="color: var(--gray-500);">Alle taken zijn af! Geniet van je avond.</p>'}
                    `;
                    break;

                case 2:
                    content.innerHTML = `
                        <div class="checkin-icon">üß†</div>
                        <div class="checkin-heading">Brain Dump</div>
                        <p style="color: var(--gray-500); margin-bottom: 16px;">Nog iets op je hoofd? Elke regel wordt een taak.</p>
                        <div class="checkin-braindump">
                            <textarea id="braindump-text" placeholder="Type hier..."></textarea>
                            <div class="checkin-braindump-tip">üí° Morgen kun je triagen</div>
                        </div>
                    `;
                    break;
            }
        }

        function finishCheckIn() {
            // Save brain dump
            const text = document.getElementById('braindump-text')?.value || '';
            if (text.trim()) {
                text.split('\n').forEach(line => {
                    if (line.trim()) {
                        state.tasks.push(createTask(line.trim()));
                    }
                });
            }

            // Update streak
            const today = new Date().toDateString();
            if (state.stats.lastCheckIn !== today) {
                const lastDate = state.stats.lastCheckIn ? new Date(state.stats.lastCheckIn) : null;
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);

                if (lastDate && lastDate.toDateString() === yesterday.toDateString()) {
                    state.stats.streak++;
                } else {
                    state.stats.streak = 1;
                }
                state.stats.lastCheckIn = today;
            }

            addPoints(20);
            saveState();

            closeCheckIn();
            document.getElementById('checkin-complete').classList.add('active');
            if (state.settings.confetti) showConfetti();

            renderHome();
            renderInbox();
            renderStats();
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', () => {
                    const view = tab.dataset.view;
                    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`view-${view}`).classList.add('active');
                    document.getElementById('header-title').textContent =
                        { home: 'Nu', inbox: 'Inbox', categories: 'Categorie√´n', stats: 'Stats', settings: 'Instellingen' }[view];
                    vibrate();
                });
            });

            // Quick Add
            document.getElementById('quick-add-btn').addEventListener('click', () => {
                const input = document.getElementById('quick-add-input');
                const title = input.value.trim();
                if (title) {
                    state.tasks.push(createTask(title));
                    input.value = '';
                    saveState();
                    renderHome();
                    renderInbox();
                    showToast('Taak toegevoegd aan inbox! üì•');
                    vibrate();
                }
            });

            document.getElementById('quick-add-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('quick-add-btn').click();
                }
            });

            // Voice button (simulated)
            document.getElementById('voice-btn').addEventListener('click', () => {
                showToast('üé§ Voice capture werkt alleen in de native iOS app');
            });

            // Today tasks - click to focus, check to complete
            document.getElementById('today-tasks').addEventListener('click', (e) => {
                const card = e.target.closest('.microstep-card');
                if (!card) return;

                const taskId = card.dataset.taskId;
                const task = state.tasks.find(t => t.id === taskId);
                if (!task) return;

                if (e.target.closest('.microstep-check')) {
                    // Complete task
                    task.status = 'done';
                    task.completedAt = new Date().toISOString();
                    state.stats.tasksDone++;
                    addPoints(25);
                    saveState();
                    renderHome();
                    renderStats();
                    if (state.settings.confetti) showConfetti();
                    showToast('Taak afgerond! üéâ');
                } else {
                    // Open focus mode
                    openFocusMode(task);
                }
            });

            // Suggestions
            document.getElementById('suggestions-list').addEventListener('click', (e) => {
                const card = e.target.closest('.suggestion-card');
                if (!card) return;

                const taskId = card.dataset.taskId;
                if (taskId) {
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) openFocusMode(task);
                }
            });

            // Focus mode
            document.getElementById('focus-close').addEventListener('click', closeFocusMode);
            document.getElementById('focus-done-btn').addEventListener('click', () => completeFocusTask(false));
            document.getElementById('focus-complete-task-btn').addEventListener('click', () => completeFocusTask(true));
            document.getElementById('focus-snooze-btn').addEventListener('click', () => {
                showToast('Taak gesnoozed voor 1 uur üò¥');
                closeFocusMode();
            });
            document.getElementById('focus-split-btn').addEventListener('click', () => {
                const newStep = prompt('Wat is een nog kleinere eerste stap?');
                if (newStep && state.focusTask) {
                    state.focusTask.microStep = newStep;
                    document.getElementById('focus-step').textContent = newStep;
                    saveState();
                    showToast('Microstap aangepast! ‚úÇÔ∏è');
                }
            });

            // Category cards
            document.getElementById('categories-grid').addEventListener('click', (e) => {
                const card = e.target.closest('.category-card');
                if (card) {
                    renderCategoryModal(card.dataset.category);
                }
            });

            // Modal
            document.getElementById('modal-close').addEventListener('click', () => {
                document.getElementById('category-modal').classList.remove('active');
            });

            document.getElementById('category-modal').addEventListener('click', (e) => {
                if (e.target.id === 'category-modal') {
                    document.getElementById('category-modal').classList.remove('active');
                }
            });

            // Modal task actions
            document.getElementById('modal-tasks-list').addEventListener('click', (e) => {
                if (e.target.closest('.task-check')) {
                    const item = e.target.closest('.task-list-item');
                    const taskId = item.dataset.taskId;
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.status = 'done';
                        task.completedAt = new Date().toISOString();
                        state.stats.tasksDone++;
                        addPoints(25);
                        saveState();
                        item.remove();
                        renderHome();
                        renderCategories();
                        renderStats();
                        if (state.settings.confetti) showConfetti();
                        showToast('Taak afgerond! üéâ');
                    }
                }
            });

            // Settings toggles
            document.querySelectorAll('.toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    toggle.classList.toggle('active');
                    const key = toggle.id.replace('toggle-', '');
                    state.settings[key] = toggle.classList.contains('active');
                    saveState();
                    vibrate();
                });
            });

            // Demo buttons
            document.getElementById('add-demo-tasks').addEventListener('click', () => {
                const demoTasks = [
                    { title: 'Mail accountant beantwoorden', cat: 'werk', micro: 'Open mail van accountant' },
                    { title: 'Belastingaangifte voorbereiden', cat: 'financien', micro: 'Zoek jaarcijfers' },
                    { title: 'Teamtraining plannen', cat: 'voetbal', micro: 'Check teamapp' },
                    { title: 'App feature bouwen', cat: 'apps', micro: 'Open Xcode' },
                    { title: 'Boodschappen doen', cat: 'gezin', micro: 'Maak lijstje' }
                ];
                demoTasks.forEach(t => {
                    state.tasks.push(createTask(t.title, t.cat, t.micro));
                });
                saveState();
                renderHome();
                renderInbox();
                renderCategories();
                showToast('5 demo taken toegevoegd! üìù');
            });

            document.getElementById('open-checkin').addEventListener('click', openCheckIn);

            document.getElementById('export-json').addEventListener('click', () => {
                const data = JSON.stringify({ tasks: state.tasks, stats: state.stats }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'werkgeheugen-export.json';
                a.click();
                showToast('Data ge√´xporteerd! üìÑ');
            });

            document.getElementById('reset-data').addEventListener('click', () => {
                if (confirm('Weet je zeker dat je alle data wilt resetten?')) {
                    localStorage.removeItem('werkgeheugen');
                    location.reload();
                }
            });

            // Check-in
            document.getElementById('checkin-close').addEventListener('click', closeCheckIn);
            document.getElementById('checkin-back').addEventListener('click', () => {
                state.checkinStep--;
                renderCheckinStep();
            });
            document.getElementById('checkin-next').addEventListener('click', () => {
                if (state.checkinStep < 2) {
                    state.checkinStep++;
                    renderCheckinStep();
                } else {
                    finishCheckIn();
                }
            });
            document.getElementById('checkin-complete-close').addEventListener('click', () => {
                document.getElementById('checkin-complete').classList.remove('active');
            });
        }

        // ==================== INIT ====================
        function init() {
            loadState();
            setupEventListeners();
            renderHome();
            renderInbox();
            renderCategories();
            renderStats();
            renderSettings();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
